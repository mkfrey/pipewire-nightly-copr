From 00782c4d5b3fc0a6ec3ac8e6f14d317c609ecd7c Mon Sep 17 00:00:00 2001
From: Pauli Virtanen <pav@iki.fi>
Date: Sat, 20 Mar 2021 15:32:26 +0200
Subject: [PATCH 05/10] pulse-server: fix route profile numbering

Route profile numbers refer to profile ids, not indices.
---
 src/modules/module-protocol-pulse/pulse-server.c | 14 +++++++++++---
 1 file changed, 11 insertions(+), 3 deletions(-)

diff --git a/src/modules/module-protocol-pulse/pulse-server.c b/src/modules/module-protocol-pulse/pulse-server.c
index 842abb16e..7a6082198 100644
--- a/src/modules/module-protocol-pulse/pulse-server.c
+++ b/src/modules/module-protocol-pulse/pulse-server.c
@@ -3964,10 +3964,18 @@ static int fill_card_info(struct client *client, struct message *m,
 				TAG_INVALID);
 
 			for (i = 0; i < pi_n_profiles; i++) {
-				uint32_t idx = pi->profiles[i];
+				uint32_t j;
+				const char *name = "off";
+
+				for (j = 0; j < n_profiles; ++j) {
+					if (profile_info[j].id == pi->profiles[i]) {
+						name = profile_info[j].name;
+						break;
+					}
+				}
+
 				message_put(m,
-					TAG_STRING, idx < n_profiles ?
-						profile_info[idx].name : "off",	/* profile name */
+					TAG_STRING, name,	/* profile name */
 					TAG_INVALID);
 			}
 			if (client->version >= 27) {
-- 
2.26.3

