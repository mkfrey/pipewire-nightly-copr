From 4b3e3cc6ca75ad0ea79f632a5184fc9d6441d23b Mon Sep 17 00:00:00 2001
From: Wim Taymans <wtaymans@redhat.com>
Date: Thu, 10 Jun 2021 09:58:11 +0200
Subject: [PATCH 2/5] alsa: open UCM only once.

See #1286 #1269
---
 spa/plugins/alsa/alsa-pcm.c | 11 ++++++-----
 1 file changed, 6 insertions(+), 5 deletions(-)

diff --git a/spa/plugins/alsa/alsa-pcm.c b/spa/plugins/alsa/alsa-pcm.c
index 0c2966d98..6b9625584 100644
--- a/spa/plugins/alsa/alsa-pcm.c
+++ b/spa/plugins/alsa/alsa-pcm.c
@@ -37,11 +37,12 @@ int spa_alsa_init(struct state *state)
 			}
 			snprintf(card_name, sizeof(card_name), "%s", name);
 			free(name);
-		}
-		err = snd_use_case_mgr_open(&state->ucm, card_name);
-		if (err < 0) {
-			spa_log_error(state->log, "UCM not available for card %s", card_name);
-			return err;
+
+			err = snd_use_case_mgr_open(&state->ucm, card_name);
+			if (err < 0) {
+				spa_log_error(state->log, "UCM not available for card %s", card_name);
+				return err;
+			}
 		}
 	}
 	return 0;
-- 
2.31.1

